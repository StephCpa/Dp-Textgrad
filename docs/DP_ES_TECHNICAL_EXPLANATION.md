# DP-ES æŠ€æœ¯è¯¦è§£ï¼šå˜å¼‚ç®—æ³•ä¸å·®åˆ†éšç§å®ç°

## ğŸ“š ç›®å½•

1. [å˜å¼‚ç®—æ³•è¯¦è§£](#å˜å¼‚ç®—æ³•è¯¦è§£)
2. [å·®åˆ†éšç§å®ç°](#å·®åˆ†éšç§å®ç°)
3. [ä¸¤è€…ç»“åˆæœºåˆ¶](#ä¸¤è€…ç»“åˆæœºåˆ¶)
4. [å®Œæ•´æµç¨‹ç¤ºä¾‹](#å®Œæ•´æµç¨‹ç¤ºä¾‹)

---

## ç¬¬ä¸€éƒ¨åˆ†ï¼šå˜å¼‚ç®—æ³•è¯¦è§£

### 1.1 æ ¸å¿ƒæ€æƒ³

**è¿›åŒ–ç­–ç•¥çš„æœ¬è´¨ï¼š**
```
åˆå§‹ç§ç¾¤ â†’ è¯„ä¼° â†’ é€‰æ‹© â†’ å˜å¼‚ â†’ æ–°ä¸€ä»£ â†’ å¾ªç¯...
```

**å˜å¼‚çš„ä½œç”¨ï¼š**
- ç”Ÿæˆæ–°çš„å€™é€‰è§£ï¼ˆæ¢ç´¢æœç´¢ç©ºé—´ï¼‰
- ä¿æŒç§ç¾¤å¤šæ ·æ€§ï¼ˆé¿å…æ—©ç†Ÿæ”¶æ•›ï¼‰
- ä¼ æ‰¿ä¼˜ç§€ç‰¹å¾ï¼ˆåˆ©ç”¨å·²æœ‰çŸ¥è¯†ï¼‰

### 1.2 æ™ºèƒ½å˜å¼‚ç®—æ³•å·¥ä½œæµç¨‹

#### **LLMå¼•å¯¼å˜å¼‚ï¼ˆLLMGuidedMutationï¼‰**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LLMå¼•å¯¼å˜å¼‚æµç¨‹                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è¾“å…¥: çˆ¶ä»£å€™é€‰
â”œâ”€ å˜é‡å€¼: "Explain this concept"
â”œâ”€ è§’è‰²æè¿°: "instruction prompt for teaching"
â”œâ”€ åé¦ˆä¿¡æ¯: DPScores (å¹³å‡åˆ†=0.6)
â””â”€ è¿­ä»£æ¬¡æ•°: iteration=3

         â†“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤1: æ„å»ºLLMæç¤ºï¼ˆ_build_mutation_promptï¼‰â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ ¹æ®æ¨¡å¼å’Œåé¦ˆç”Ÿæˆæç¤ºï¼š

"""
You are helping optimize text through evolutionary mutation.

**Current text** (instruction prompt for teaching):
"Explain this concept"

Previous evaluation score: 0.60/1.0
Iteration: 3

**Task**: Generate 2 improved variations of this text.

**Mutation strategy**: Create a MIX of small improvements
and larger creative changes.

**Requirements**:
1. Each variation should be different from the original
2. Maintain the core purpose: instruction prompt for teaching
3. Output exactly 2 variations, separated by "---VARIANT---"

Generate the variations now:
"""

         â†“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤2: LLMç”Ÿæˆå˜å¼‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

LLMå“åº”:
"""
Provide a clear, step-by-step explanation of this concept
with concrete examples.
---VARIANT---
Explain this concept thoroughly, breaking it down into
digestible parts and illustrating key points.
"""

         â†“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤3: è§£æå˜å¼‚ç»“æœï¼ˆ_parse_variationsï¼‰â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æå–å˜å¼‚ä½“ï¼š
- Variant 1: "Provide a clear, step-by-step explanation..."
- Variant 2: "Explain this concept thoroughly..."

         â†“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤4: å¤šæ ·æ€§æ£€æŸ¥ï¼ˆ_enforce_diversityï¼‰ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è®¡ç®—ç›¸ä¼¼åº¦ï¼š
- Variant 1 vs Parent: 0.3 (è¶³å¤Ÿä¸åŒ âœ“)
- Variant 2 vs Parent: 0.4 (è¶³å¤Ÿä¸åŒ âœ“)
- Variant 1 vs Variant 2: 0.5 (è¶³å¤Ÿä¸åŒ âœ“)

å¦‚æœç›¸ä¼¼åº¦ > thresholdï¼Œæ·»åŠ æ‰°åŠ¨

         â†“

è¾“å‡º: 2ä¸ªVariableå¯¹è±¡
â”œâ”€ Variable("Provide a clear, step-by-step...", ...)
â””â”€ Variable("Explain this concept thoroughly...", ...)
```

#### **å…³é”®ä»£ç å®ç°**

```python
class LLMGuidedMutation:
    def __call__(self, parent, iteration, rng, feedback, num_offspring=2):
        # 1. æå–çˆ¶ä»£ä¿¡æ¯
        parent_text = parent.variable.get_value()
        role_desc = parent.variable.get_role_description()

        # 2. æ„å»ºæ™ºèƒ½æç¤º
        prompt = self._build_mutation_prompt(
            parent_text, role_desc, iteration, feedback, num_offspring
        )
        # æç¤ºåŒ…å«ï¼š
        # - çˆ¶ä»£æ–‡æœ¬
        # - è§’è‰²æè¿°ï¼ˆå‘Šè¯‰LLMè¿™æ˜¯ä»€ä¹ˆï¼‰
        # - åé¦ˆä¿¡æ¯ï¼ˆå‘Šè¯‰LLMè¡¨ç°å¦‚ä½•ï¼‰
        # - å˜å¼‚ç­–ç•¥ï¼ˆæ¢ç´¢/åˆ©ç”¨/å¹³è¡¡ï¼‰

        # 3. LLMç”Ÿæˆå˜å¼‚
        response = self.engine.generate(prompt)

        # 4. è§£æå¤šä¸ªå˜å¼‚
        variations = self._parse_variations(response, num_offspring)

        # 5. å¼ºåˆ¶å¤šæ ·æ€§ï¼ˆé˜²æ­¢é‡å¤ï¼‰
        if self.diversity_weight > 0:
            variations = self._enforce_diversity(variations, parent_text, rng)

        # 6. è½¬æ¢ä¸ºVariableå¯¹è±¡
        return [Variable(v, role_description=role_desc, requires_grad=True)
                for v in variations]
```

### 1.3 è‡ªé€‚åº”å˜å¼‚ç­–ç•¥

**æ ¸å¿ƒåˆ›æ–°ï¼šæ ¹æ®ä¼˜åŒ–è¿›åº¦è‡ªåŠ¨è°ƒæ•´ç­–ç•¥**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 è‡ªé€‚åº”å˜å¼‚å†³ç­–æ ‘                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    å¼€å§‹ä¼˜åŒ–
                        â”‚
                        â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   æ£€æŸ¥å½“å‰çŠ¶æ€         â”‚
            â”‚ - è¿­ä»£æ¬¡æ•°             â”‚
            â”‚ - æ€§èƒ½æå‡è¶‹åŠ¿         â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“               â†“               â†“
    æ—©æœŸé˜¶æ®µ        ä¸­æœŸé˜¶æ®µ        åæœŸé˜¶æ®µ
   (iter<30%)     (30-70%)        (>70%)
        â”‚               â”‚               â”‚
        â†“               â†“               â†“
   EXPLOREæ¨¡å¼     BALANCEDæ¨¡å¼     EXPLOITæ¨¡å¼
  ï¼ˆå¤§èƒ†æ¢ç´¢ï¼‰     ï¼ˆå¹³è¡¡ç­–ç•¥ï¼‰     ï¼ˆç²¾ç»†è°ƒä¼˜ï¼‰
        â”‚               â”‚               â”‚
        â”‚               â”‚               â”‚
    æ£€æµ‹æ€§èƒ½plateauï¼Ÿ   â”‚               â”‚
        â”‚               â”‚               â”‚
        â†“               â†“               â†“
    æå‡<0.01?     æå‡<0.01?     æå‡<0.01?
        â”‚               â”‚               â”‚
    æ˜¯â”€â”€â”´â†’ åˆ‡æ¢åˆ°EXPLOREï¼ˆé€ƒç¦»å±€éƒ¨æœ€ä¼˜ï¼‰
        â”‚
    å¦â”€â”€â”´â†’ ä¿æŒå½“å‰æ¨¡å¼
```

**ä»£ç å®ç°ï¼š**

```python
class AdaptiveMutation:
    def _update_mode(self, iteration, feedback):
        # æå–å½“å‰å¾—åˆ†
        if feedback and isinstance(feedback, DPScores):
            current_score = max(r.dp_score for r in feedback.records)
            self.iteration_scores.append(current_score)

        # æ£€æµ‹æ€§èƒ½plateauï¼ˆè¿ç»­3æ¬¡æå‡<0.01ï¼‰
        if len(self.iteration_scores) >= 3:
            recent_improvement = (
                self.iteration_scores[-1] - self.iteration_scores[-3]
            )

            if recent_improvement < 0.01:
                # åœæ»ä¸å‰ â†’ æ¢ç´¢æ–°æ–¹å‘
                self.mode = MutationMode.EXPLORE
                print("âš ï¸ æ£€æµ‹åˆ°æ€§èƒ½plateauï¼Œåˆ‡æ¢åˆ°EXPLOREæ¨¡å¼")

            elif recent_improvement > 0.1:
                # å¿«é€Ÿæå‡ â†’ æ·±åŒ–å½“å‰æ–¹å‘
                self.mode = MutationMode.EXPLOIT
                print("âœ“ å¿«é€Ÿæå‡ä¸­ï¼Œåˆ‡æ¢åˆ°EXPLOITæ¨¡å¼")

            else:
                # ç¨³å®šæå‡ â†’ ä¿æŒå¹³è¡¡
                self.mode = MutationMode.BALANCED
```

### 1.4 å˜å¼‚æ¨¡å¼å¯¹æ¯”

| ç‰¹å¾ | EXPLOITï¼ˆåˆ©ç”¨ï¼‰ | BALANCEDï¼ˆå¹³è¡¡ï¼‰ | EXPLOREï¼ˆæ¢ç´¢ï¼‰ |
|------|----------------|-----------------|----------------|
| **å˜å¼‚å¹…åº¦** | å°ï¼ˆå±€éƒ¨ï¼‰ | ä¸­ç­‰ | å¤§ï¼ˆå…¨å±€ï¼‰ |
| **åˆ›æ–°ç¨‹åº¦** | ä¿å®ˆæ”¹è¿› | æ··åˆ | å¤§èƒ†åˆ›æ–° |
| **é€‚ç”¨é˜¶æ®µ** | åæœŸç²¾è°ƒ | ä¸­æœŸ | æ—©æœŸæœç´¢ |
| **é£é™©** | ä½ï¼ˆå¯èƒ½å±€éƒ¨æœ€ä¼˜ï¼‰ | ä¸­ | é«˜ï¼ˆå¯èƒ½å˜å·®ï¼‰ |
| **æ”¶æ•›é€Ÿåº¦** | å¿« | ä¸­ | æ…¢ |

**ç¤ºä¾‹å¯¹æ¯”ï¼š**

```python
çˆ¶ä»£: "Explain the concept"

# EXPLOITæ¨¡å¼ï¼ˆå°å¹…æ”¹è¿›ï¼‰
â†’ "Explain the concept clearly"
â†’ "Explain the concept with examples"

# BALANCEDæ¨¡å¼ï¼ˆæ··åˆç­–ç•¥ï¼‰
â†’ "Provide a clear explanation of the concept"
â†’ "Explain step-by-step with examples and reasoning"

# EXPLOREæ¨¡å¼ï¼ˆå¤§èƒ†åˆ›æ–°ï¼‰
â†’ "Break down the concept into digestible parts with analogies"
â†’ "Guide learners through the concept using a story-based approach"
```

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šå·®åˆ†éšç§å®ç°

### 2.1 å·®åˆ†éšç§æ ¸å¿ƒåŸç†

**å®šä¹‰ï¼š**
```
å¯¹äºé‚»å±…æ•°æ®é›† D å’Œ D'ï¼ˆä»…å·®ä¸€æ¡è®°å½•ï¼‰ï¼Œ
å¦‚æœæœºåˆ¶ M æ»¡è¶³ï¼š

Pr[M(D) âˆˆ S] â‰¤ e^Îµ Ã— Pr[M(D') âˆˆ S] + Î´

åˆ™ç§° M æ»¡è¶³ (Îµ, Î´)-å·®åˆ†éšç§
```

**ç›´è§‚ç†è§£ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æœ‰ä½ çš„æ•°æ®é›† D  vs  æ²¡ä½ çš„æ•°æ®é›† D'     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

     D = [è®°å½•1, è®°å½•2, ..., ä½ çš„è®°å½•]
     D' = [è®°å½•1, è®°å½•2, ..., (ä½ çš„è®°å½•è¢«ç§»é™¤)]

æ‰§è¡ŒDP-ESä¼˜åŒ–ï¼š
     M(D)  â†’ ç»“æœ1
     M(D') â†’ ç»“æœ2

å·®åˆ†éšç§ä¿è¯ï¼š
     ç»“æœ1 å’Œ ç»“æœ2 å‡ ä¹æ— æ³•åŒºåˆ†ï¼
     â†“
     æ”»å‡»è€…æ— æ³•æ¨æ–­ä½ æ˜¯å¦åœ¨æ•°æ®é›†ä¸­
```

### 2.2 DP-ESä¸­çš„éšç§å®ç°æœºåˆ¶

#### **æœºåˆ¶1ï¼šè¯„åˆ†æ—¶çš„å™ªå£°æ³¨å…¥ï¼ˆDPScorerï¼‰**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              DPè¯„åˆ†æœºåˆ¶ï¼ˆé«˜æ–¯æœºåˆ¶ï¼‰                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è¾“å…¥: å€™é€‰é›†åˆ + è¯„ä¼°å‡½æ•°
â”œâ”€ Candidate 1: "Explain clearly"
â”œâ”€ Candidate 2: "Provide details"
â””â”€ Candidate 3: "Use examples"

         â†“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤1: åŸå§‹è¯„åˆ†ï¼ˆæ— éšç§ä¿æŠ¤ï¼‰           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

evaluation_fn(candidate) â†’ raw_score

Candidate 1: 0.85
Candidate 2: 0.62
Candidate 3: 1.23  â† è¶…å‡ºè¾¹ç•Œï¼

         â†“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤2: è£å‰ªï¼ˆClippingï¼‰                 â”‚
â”‚ ç›®çš„ï¼šé™åˆ¶å•æ¡è®°å½•çš„å½±å“ï¼ˆæ§åˆ¶æ•æ„Ÿåº¦ï¼‰  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

clipped_score = clip(raw_score, -C, C)
å…¶ä¸­ C = clipping_value

Candidate 1: min(0.85, 1.0) = 0.85
Candidate 2: min(0.62, 1.0) = 0.62
Candidate 3: min(1.23, 1.0) = 1.00  â† è¢«è£å‰ª

æ•æ„Ÿåº¦Î”f = 2C = 2.0

         â†“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤3: é«˜æ–¯å™ªå£°æ³¨å…¥                     â”‚
â”‚ ç›®çš„ï¼šæ©ç›–å•æ¡è®°å½•çš„å­˜åœ¨/ä¸å­˜åœ¨         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å™ªå£°å°ºåº¦Ïƒè®¡ç®—ï¼š
Ïƒ = (Î”f / Îµ) Ã— âˆš(2 ln(1.25/Î´))
  = (2.0 / 0.5) Ã— âˆš(2 ln(1.25/1e-5))
  = 4.0 Ã— âˆš(2 Ã— 11.5)
  â‰ˆ 19.2

ä» N(0, ÏƒÂ²) é‡‡æ ·å™ªå£°ï¼š
noise_1 = +0.15
noise_2 = -0.08
noise_3 = +0.12

dp_score = clipped_score + noise

Candidate 1: 0.85 + 0.15 = 1.00
Candidate 2: 0.62 - 0.08 = 0.54
Candidate 3: 1.00 + 0.12 = 1.12

         â†“

è¾“å‡º: DPè¯„åˆ†ç»“æœ
â”œâ”€ (Îµ=0.5, Î´=1e-5) éšç§ä¿è¯
â””â”€ æ¯ä¸ªå€™é€‰çš„ dp_score å¯ä»¥å®‰å…¨ä½¿ç”¨
```

**å…³é”®ä»£ç ï¼š**

```python
class DPScorer:
    def evaluate(self, candidates, evaluation_fn, rng):
        records = []

        for candidate in candidates:
            # 1. åŸå§‹è¯„åˆ†ï¼ˆå¯èƒ½ä½¿ç”¨ç§æœ‰æ•°æ®ï¼‰
            raw_score = evaluation_fn(candidate)

            # 2. è£å‰ªï¼ˆé™åˆ¶æ•æ„Ÿåº¦ï¼‰
            clipped_score = np.clip(
                raw_score,
                -self.config.clipping_value,
                self.config.clipping_value
            )

            # 3. è®¡ç®—å™ªå£°å°ºåº¦
            if self.config.noise_multiplier is None:
                # è‡ªåŠ¨æ ¡å‡†Ïƒä»¥æ»¡è¶³(Îµ,Î´)-DP
                sigma = self._calibrate_noise_scale(
                    sensitivity=2 * self.config.clipping_value,
                    epsilon=self.config.epsilon,
                    delta=self.config.delta
                )
            else:
                sigma = self.config.clipping_value * self.config.noise_multiplier

            # 4. æ³¨å…¥é«˜æ–¯å™ªå£°
            noise = rng.gauss(0, sigma)
            dp_score = clipped_score + noise

            records.append(ScoreRecord(
                raw_score=raw_score,
                clipped_score=clipped_score,
                noise=noise,
                dp_score=dp_score
            ))

        return DPScores(
            records=records,
            epsilon=self.config.epsilon,
            delta=self.config.delta
        )
```

#### **æœºåˆ¶2ï¼šé€‰æ‹©æ—¶çš„æŒ‡æ•°æœºåˆ¶ï¼ˆDPSelectorï¼‰**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           DPé€‰æ‹©æœºåˆ¶ï¼ˆæŒ‡æ•°æœºåˆ¶ + Gumbelå™ªå£°ï¼‰                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è¾“å…¥: å·²è¯„åˆ†çš„å€™é€‰ï¼ˆå¸¦DPåˆ†æ•°ï¼‰
â”œâ”€ Candidate 1: dp_score=1.00
â”œâ”€ Candidate 2: dp_score=0.54
â”œâ”€ Candidate 3: dp_score=1.12
â””â”€ Candidate 4: dp_score=0.78

é€‰æ‹©ç›®æ ‡: é€‰æ‹©top-k=2ä¸ªå€™é€‰

         â†“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ–¹æ¡ˆA: Noisy Top-kï¼ˆåŠ å™ªæ’åºï¼‰          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¸ºæ¯ä¸ªåˆ†æ•°æ·»åŠ Gumbelå™ªå£°ï¼š
scale = sensitivity / epsilon = 1.0 / 0.1 = 10.0

gumbel_noise ~ Gumbel(0, scale)

Candidate 1: 1.00 + gumbel(-2.3) = -1.30
Candidate 2: 0.54 + gumbel(+1.8) = +2.34  â† é€‰ä¸­
Candidate 3: 1.12 + gumbel(+0.5) = +1.62  â† é€‰ä¸­
Candidate 4: 0.78 + gumbel(-0.9) = -0.12

æŒ‰åŠ å™ªååˆ†æ•°æ’åº â†’ é€‰æ‹©top-2

         â†“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ–¹æ¡ˆB: æŒ‡æ•°æœºåˆ¶ï¼ˆåŸºäºæ¦‚ç‡é‡‡æ ·ï¼‰         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è®¡ç®—æ¯ä¸ªå€™é€‰çš„é€‰æ‹©æ¦‚ç‡ï¼š
p_i âˆ exp(Îµ Ã— score_i / (2 Ã— sensitivity))

Candidate 1: exp(0.1Ã—1.00/2) = exp(0.05) = 1.051
Candidate 2: exp(0.1Ã—0.54/2) = exp(0.027) = 1.027
Candidate 3: exp(0.1Ã—1.12/2) = exp(0.056) = 1.058
Candidate 4: exp(0.1Ã—0.78/2) = exp(0.039) = 1.040

å½’ä¸€åŒ–æ¦‚ç‡ï¼š
Total = 4.176
p_1 = 1.051/4.176 = 0.252
p_2 = 1.027/4.176 = 0.246
p_3 = 1.058/4.176 = 0.253
p_4 = 1.040/4.176 = 0.249

æ ¹æ®æ¦‚ç‡é‡‡æ ·k=2ä¸ªå€™é€‰

         â†“

è¾“å‡º: é€‰ä¸­çš„å€™é€‰ + éšç§æˆæœ¬
â”œâ”€ Selected: [Candidate 2, Candidate 3]
â”œâ”€ Privacy cost: Îµ=0.1, Î´=0
â””â”€ Selection metadata
```

**å…³é”®ä»£ç ï¼š**

```python
class DPSelector:
    def select_with_metadata(self, candidates, rng):
        # æå–DPåˆ†æ•°
        scores = [c.dp_score for c in candidates]

        # æ·»åŠ Gumbelå™ªå£°ï¼ˆå®ç°æŒ‡æ•°æœºåˆ¶ï¼‰
        gumbel_scale = self.config.sensitivity / self.config.epsilon

        noisy_scores = []
        for score in scores:
            gumbel_noise = self._sample_gumbel(rng, scale=gumbel_scale)
            noisy_score = score + gumbel_noise
            noisy_scores.append(noisy_score)

        # æŒ‰åŠ å™ªåˆ†æ•°æ’åºï¼Œé€‰æ‹©top-k
        sorted_indices = np.argsort(noisy_scores)[::-1]
        selected_indices = sorted_indices[:self.config.select_k]

        selected = [candidates[i] for i in selected_indices]

        return DPSelectionResult(
            selected=selected,
            epsilon=self.config.epsilon,
            delta=0.0,  # æŒ‡æ•°æœºåˆ¶çš„Î´=0ï¼ˆçº¯DPï¼‰
            records=[...]
        )
```

### 2.3 éšç§é¢„ç®—è¿½è¸ªï¼ˆPrivacyAccountantï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   éšç§é¢„ç®—ä¼šè®¡ç³»ç»Ÿ                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åˆå§‹é¢„ç®—ï¼š
â”œâ”€ Target Îµ: 3.0
â””â”€ Target Î´: 1e-4

         â†“

è¿­ä»£1ï¼šè¯„åˆ† + é€‰æ‹©
â”œâ”€ è¯„åˆ†æ¶ˆè€—: Îµâ‚=0.5, Î´â‚=1e-5
â”œâ”€ é€‰æ‹©æ¶ˆè€—: Îµâ‚‚=0.1, Î´â‚‚=0
â””â”€ ç´¯è®¡: Îµ=0.6, Î´=1e-5

         â†“

è¿­ä»£2ï¼šè¯„åˆ† + é€‰æ‹©
â”œâ”€ è¯„åˆ†æ¶ˆè€—: Îµâ‚ƒ=0.5, Î´â‚ƒ=1e-5
â”œâ”€ é€‰æ‹©æ¶ˆè€—: Îµâ‚„=0.1, Î´â‚„=0
â””â”€ ç´¯è®¡: Îµ=1.2, Î´=2e-5

         â†“

è¿­ä»£3ï¼šè¯„åˆ† + é€‰æ‹©
â”œâ”€ è¯„åˆ†æ¶ˆè€—: Îµâ‚…=0.5, Î´â‚…=1e-5
â”œâ”€ é€‰æ‹©æ¶ˆè€—: Îµâ‚†=0.1, Î´â‚†=0
â””â”€ ç´¯è®¡: Îµ=1.8, Î´=3e-5

         â†“

...ç»§ç»­ç›´åˆ°é¢„ç®—è€—å°½...

         â†“

è¿­ä»£5ï¼šè¯„åˆ†
â”œâ”€ è¯„åˆ†æ¶ˆè€—: Îµâ‚‰=0.5, Î´â‚‰=1e-5
â”œâ”€ ç´¯è®¡: Îµ=3.0, Î´=5e-5
â””â”€ âš ï¸ Îµé¢„ç®—è€—å°½ï¼åœæ­¢ä¼˜åŒ–
```

**ä¸¤ç§ç»„åˆæ–¹å¼ï¼š**

#### **A. åŸºç¡€ç»„åˆï¼ˆSequential Compositionï¼‰**

```
Îµ_total = Î£ Îµ_i
Î´_total = Î£ Î´_i

ç®€å•ç›¸åŠ ï¼Œä½†è¿‡äºä¿å®ˆ
```

#### **B. é«˜çº§ç»„åˆï¼ˆAdvanced Compositionï¼‰** â­

```
Îµ_total â‰¤ âˆš(2k ln(1/Î´')) Ã— Îµ + kÃ—ÎµÃ—(e^Îµ - 1)

å…¶ä¸­ï¼š
- k = æ“ä½œæ¬¡æ•°
- Îµ = å•æ¬¡æ“ä½œçš„éšç§é¢„ç®—
- Î´' = æ€»ä½“Î´é¢„ç®—

ä¼˜åŠ¿ï¼šæ¯”åŸºç¡€ç»„åˆèŠ‚çœéšç§é¢„ç®—ï¼
```

**ç¤ºä¾‹å¯¹æ¯”ï¼š**

```python
# åœºæ™¯ï¼š10æ¬¡æ“ä½œï¼Œæ¯æ¬¡Îµ=0.5

# åŸºç¡€ç»„åˆ
Îµ_basic = 10 Ã— 0.5 = 5.0

# é«˜çº§ç»„åˆ
import math
k = 10
eps_per_op = 0.5
delta = 1e-5

Îµ_advanced = math.sqrt(2 * k * math.log(1/delta)) * eps_per_op
Îµ_advanced â‰ˆ 1.58  # èŠ‚çœäº† 70% çš„éšç§é¢„ç®—ï¼
```

**ä»£ç å®ç°ï¼š**

```python
class AdvancedCompositionAccountant:
    def consume(self, epsilon, delta, description=""):
        # è®°å½•æ“ä½œ
        self.operations.append((epsilon, delta, description))

        # ä½¿ç”¨é«˜çº§ç»„åˆå®šç†è®¡ç®—ç´¯è®¡éšç§
        k = len(self.operations)
        eps_sum = sum(op[0] for op in self.operations)

        # é«˜çº§ç»„åˆå…¬å¼
        eps_advanced = math.sqrt(
            2 * k * math.log(1 / self.delta_slack)
        ) * eps_sum / k

        self.consumed_epsilon = eps_advanced
        self.consumed_delta = sum(op[1] for op in self.operations)

        # æ£€æŸ¥æ˜¯å¦è¶…é¢„ç®—
        if self.consumed_epsilon > self.target_epsilon:
            raise PrivacyBudgetExceeded(
                f"Privacy budget exceeded: {self.consumed_epsilon:.3f} > {self.target_epsilon}"
            )
```

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šä¸¤è€…ç»“åˆæœºåˆ¶

### 3.1 DP-ESå®Œæ•´æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              DP-ES å®Œæ•´ä¼˜åŒ–å¾ªç¯ï¼ˆå¸¦éšç§ä¿æŠ¤ï¼‰                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åˆå§‹åŒ–
â”œâ”€ åˆ›å»ºåˆå§‹ç§ç¾¤ï¼ˆ6ä¸ªå€™é€‰ï¼‰
â”œâ”€ éšç§é¢„ç®—ï¼šÎµ=3.0, Î´=1e-4
â””â”€ å˜å¼‚ç­–ç•¥ï¼šAdaptiveï¼ˆè‡ªåŠ¨è°ƒèŠ‚ï¼‰

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

è¿­ä»£ 1
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤1: DPè¯„åˆ†ï¼ˆDPScorerï¼‰               â”‚
â”‚ â”œâ”€ è¯„ä¼°6ä¸ªå€™é€‰                          â”‚
â”‚ â”œâ”€ è£å‰ªåˆ†æ•°: [-1, 1]                   â”‚
â”‚ â”œâ”€ æ³¨å…¥å™ªå£°: Ïƒ=19.2                    â”‚
â”‚ â”œâ”€ éšç§æˆæœ¬: Îµ=0.5, Î´=1e-5             â”‚
â”‚ â””â”€ ç´¯è®¡é¢„ç®—: Îµ=0.5, Î´=1e-5             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤2: DPé€‰æ‹©ï¼ˆDPSelectorï¼‰             â”‚
â”‚ â”œâ”€ Gumbelå™ªå£°åŠ åˆ°DPåˆ†æ•°                â”‚
â”‚ â”œâ”€ é€‰æ‹©top-3ä½œä¸ºçˆ¶ä»£                    â”‚
â”‚ â”œâ”€ éšç§æˆæœ¬: Îµ=0.1, Î´=0                â”‚
â”‚ â””â”€ ç´¯è®¡é¢„ç®—: Îµ=0.6, Î´=1e-5             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤3: æ™ºèƒ½å˜å¼‚ï¼ˆAdaptiveMutationï¼‰     â”‚
â”‚ â”œâ”€ æ¨¡å¼ï¼šEXPLOREï¼ˆæ—©æœŸé˜¶æ®µï¼‰            â”‚
â”‚ â”œâ”€ æ¯ä¸ªçˆ¶ä»£ â†’ 2ä¸ªåä»£                   â”‚
â”‚ â”œâ”€ LLMç”Ÿæˆæœ‰æ„ä¹‰çš„æ”¹è¿›                  â”‚
â”‚ â”œâ”€ éšç§æˆæœ¬: 0ï¼ˆä¸ä½¿ç”¨ç§æœ‰æ•°æ®ï¼‰        â”‚
â”‚ â””â”€ ç´¯è®¡é¢„ç®—: Îµ=0.6, Î´=1e-5 (ä¸å˜)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
     æ–°ç§ç¾¤ï¼š3çˆ¶ä»£ + 6åä»£ = 9ä¸ª
     é€‰æ‹©top-6è¿›å…¥ä¸‹ä¸€ä»£

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

è¿­ä»£ 2-4
... é‡å¤ä¸Šè¿°æµç¨‹ ...
ç´¯è®¡é¢„ç®—é€æ¸å¢é•¿

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

è¿­ä»£ 5
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤1: DPè¯„åˆ†                           â”‚
â”‚ â”œâ”€ ç´¯è®¡é¢„ç®—: Îµ=2.9, Î´=4.5e-5           â”‚
â”‚ â””â”€ å‰©ä½™é¢„ç®—: Îµ=0.1 âš ï¸ å³å°†è€—å°½          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤2: é¢„ç®—æ£€æŸ¥                         â”‚
â”‚ â””â”€ Îµ=3.0 > target_Îµ=3.0                â”‚
â”‚     â†’ PrivacyBudgetExceeded å¼‚å¸¸       â”‚
â”‚     â†’ åœæ­¢ä¼˜åŒ–                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ä¼˜åŒ–å®Œæˆ
â”œâ”€ æ€»è¿­ä»£æ¬¡æ•°: 5
â”œâ”€ éšç§æ¶ˆè€—: Îµ=3.0, Î´=4.5e-5
â”œâ”€ æœ€ä½³å€™é€‰: prompt_variable.get_value()
â””â”€ æ€§èƒ½æå‡: +0.38 (from 0.30 to 0.68)
```

### 3.2 å…³é”®è®¾è®¡å†³ç­–

#### **å†³ç­–1ï¼šå˜å¼‚ä¸æ¶ˆè€—éšç§é¢„ç®—**

**åŸå› ï¼š**
```
å˜å¼‚è¿‡ç¨‹ï¼š
çˆ¶ä»£æ–‡æœ¬ â†’ LLM â†’ æ–°æ–‡æœ¬

ä¸æ¶‰åŠç§æœ‰æ•°æ®ï¼
â†“
ä¸éœ€è¦å·®åˆ†éšç§ä¿æŠ¤
â†“
ä¸æ¶ˆè€—éšç§é¢„ç®—
```

**å¥½å¤„ï¼š**
- å¯ä»¥è‡ªç”±ä½¿ç”¨æ™ºèƒ½å˜å¼‚
- ä¸ä¼šå› ä¸ºå˜å¼‚å¤æ‚åº¦å¢åŠ éšç§æˆæœ¬
- éšç§é¢„ç®—å…¨éƒ¨ç”¨äºè¯„åˆ†å’Œé€‰æ‹©

#### **å†³ç­–2ï¼šè¯„åˆ†å¿…é¡»ä½¿ç”¨DP**

**åŸå› ï¼š**
```
è¯„åˆ†è¿‡ç¨‹ï¼š
å€™é€‰æ–‡æœ¬ + ç§æœ‰æ•°æ®é›† â†’ è¯„ä¼°å‡½æ•° â†’ åˆ†æ•°

ä½¿ç”¨ç§æœ‰æ•°æ®ï¼
â†“
å¿…é¡»å·®åˆ†éšç§ä¿æŠ¤
â†“
éœ€è¦æ¶ˆè€—éšç§é¢„ç®—
```

**æœºåˆ¶ï¼š**
1. è£å‰ªï¼šé™åˆ¶å•æ¡è®°å½•å½±å“
2. åŠ å™ªï¼šæ©ç›–è®°å½•å­˜åœ¨æ€§
3. é¢„ç®—è¿½è¸ªï¼šç´¯è®¡éšç§æ¶ˆè€—

#### **å†³ç­–3ï¼šé€‰æ‹©å¯é€‰æ‹©æ€§ä½¿ç”¨DP**

**åœºæ™¯åˆ†æï¼š**
```
å¦‚æœé€‰æ‹©åŸºäºDPåˆ†æ•°ï¼ˆå·²åŠ å™ªï¼‰ï¼š
â”œâ”€ é€‰æ‹© Îµ=0ï¼šç›´æ¥ç”¨DPåˆ†æ•°ï¼Œæ— é¢å¤–éšç§æˆæœ¬
â””â”€ é€‰æ‹© Îµ>0ï¼šé¢å¤–åŠ Gumbelå™ªå£°ï¼Œå¢åŠ éšæœºæ€§

æ¨èé…ç½®ï¼š
â”œâ”€ é¢„ç®—å……è¶³ï¼šé€‰æ‹©Îµ=0.1ï¼ˆæ›´é²æ£’ï¼‰
â””â”€ é¢„ç®—ç´§å¼ ï¼šé€‰æ‹©Îµ=0ï¼ˆèŠ‚çœé¢„ç®—ï¼‰
```

### 3.3 éšç§ä¿è¯çš„æ•°å­¦è¯æ˜ï¼ˆç®€åŒ–ï¼‰

**å®šç†ï¼š** DP-ESæ»¡è¶³(Îµ_total, Î´_total)-å·®åˆ†éšç§

**è¯æ˜æ€è·¯ï¼š**

```
1. å•æ¬¡è¯„åˆ†æ»¡è¶³(Îµâ‚, Î´â‚)-DPï¼ˆé«˜æ–¯æœºåˆ¶ï¼‰
   âœ“ è¯æ˜ï¼šè£å‰ªæ§åˆ¶æ•æ„Ÿåº¦ï¼Œé«˜æ–¯å™ªå£°æ»¡è¶³DP

2. å•æ¬¡é€‰æ‹©æ»¡è¶³(Îµâ‚‚, 0)-DPï¼ˆæŒ‡æ•°æœºåˆ¶ï¼‰
   âœ“ è¯æ˜ï¼šGumbelå™ªå£°ç­‰ä»·äºæŒ‡æ•°æœºåˆ¶

3. å˜å¼‚ä¸æ¶ˆè€—éšç§
   âœ“ è¯æ˜ï¼šä¸è®¿é—®ç§æœ‰æ•°æ®

4. ç»„åˆå®šç†ï¼š
   kæ¬¡(Îµ, Î´)-DPæ“ä½œ â†’ (Îµ_total, Î´_total)-DP

   é«˜çº§ç»„åˆï¼š
   Îµ_total â‰¤ âˆš(2k ln(1/Î´')) Ã— Îµ + kÃ—ÎµÃ—(e^Îµ - 1)
   Î´_total â‰¤ kÃ—Î´ + Î´'

   âœ“ PrivacyAccountant å®ç°äº†è¿™ä¸ªå…¬å¼

ç»“è®ºï¼šDP-ESæ•´ä½“æ»¡è¶³å·®åˆ†éšç§ï¼
```

---

## ç¬¬å››éƒ¨åˆ†ï¼šå®Œæ•´æµç¨‹ç¤ºä¾‹

### 4.1 å…·ä½“æ•°å€¼ç¤ºä¾‹

**ä»»åŠ¡ï¼š** ä¼˜åŒ–é—®ç­”prompt

**åˆå§‹çŠ¶æ€ï¼š**
```python
initial_prompt = "Answer the question."
initial_score = 0.30

privacy_budget = (Îµ=3.0, Î´=1e-4)
```

**è¿­ä»£1è¯¦ç»†è¿‡ç¨‹ï¼š**

```
ã€ç§ç¾¤çŠ¶æ€ã€‘
Candidate 0: "Answer the question." (æ ¹å€™é€‰)

1ï¸âƒ£ å˜å¼‚é˜¶æ®µï¼ˆç”Ÿæˆåˆå§‹ç§ç¾¤ï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
å˜å¼‚å™¨ï¼šAdaptiveMutation (EXPLOREæ¨¡å¼)
è¾“å…¥ï¼šæ ¹å€™é€‰
è¾“å‡ºï¼š
  â†’ "Provide a detailed answer to the question with examples"
  â†’ "Answer the question step-by-step with clear reasoning"
  â†’ "Explain your answer thoroughly with supporting evidence"
  â†’ ... (å…±ç”Ÿæˆ5ä¸ª)

ã€æ–°ç§ç¾¤ã€‘6ä¸ªå€™é€‰ï¼ˆ1æ ¹+5å˜å¼‚ï¼‰

2ï¸âƒ£ è¯„åˆ†é˜¶æ®µï¼ˆDP Scoringï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
é…ç½®ï¼šclipping=1.0, Îµ=0.5, Î´=1e-5

Cand 0: raw=0.30 â†’ clip=0.30 â†’ noise=+0.12 â†’ dp=0.42
Cand 1: raw=0.65 â†’ clip=0.65 â†’ noise=-0.08 â†’ dp=0.57
Cand 2: raw=0.58 â†’ clip=0.58 â†’ noise=+0.15 â†’ dp=0.73 â­
Cand 3: raw=0.72 â†’ clip=0.72 â†’ noise=+0.05 â†’ dp=0.77 â­
Cand 4: raw=0.45 â†’ clip=0.45 â†’ noise=-0.11 â†’ dp=0.34
Cand 5: raw=0.61 â†’ clip=0.61 â†’ noise=+0.09 â†’ dp=0.70 â­

éšç§æ¶ˆè€—ï¼šÎµ=0.5, Î´=1e-5
ç´¯è®¡é¢„ç®—ï¼šÎµ=0.5, Î´=1e-5

3ï¸âƒ£ é€‰æ‹©é˜¶æ®µï¼ˆDP Selectionï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
é…ç½®ï¼šselect_k=3, Îµ=0.1

æ·»åŠ Gumbelå™ªå£°ï¼š
Cand 0: 0.42 + (-1.2) = -0.78
Cand 1: 0.57 + (+0.5) = +1.07 âœ“
Cand 2: 0.73 + (+0.8) = +1.53 âœ“
Cand 3: 0.77 + (-0.3) = +0.47
Cand 4: 0.34 + (-0.9) = -0.56
Cand 5: 0.70 + (+1.1) = +1.80 âœ“

é€‰ä¸­ï¼šCand 2, 5, 1 (æŒ‰åŠ å™ªåˆ†æ•°æ’åº)

éšç§æ¶ˆè€—ï¼šÎµ=0.1, Î´=0
ç´¯è®¡é¢„ç®—ï¼šÎµ=0.6, Î´=1e-5

ã€çˆ¶ä»£ã€‘3ä¸ªå€™é€‰

4ï¸âƒ£ å˜å¼‚é˜¶æ®µï¼ˆç”Ÿæˆæ–°åä»£ï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ¯ä¸ªçˆ¶ä»£ â†’ 2ä¸ªåä»£

Parent 1: "Answer the question step-by-step..."
  Child 1.1: "Break down the question and answer each part systematically..."
  Child 1.2: "Provide a structured, step-by-step response with examples..."

Parent 2: "Explain your answer thoroughly..."
  Child 2.1: "Give a comprehensive answer with detailed explanations..."
  Child 2.2: "Answer with thorough reasoning and evidence to support..."

Parent 3: "Provide a detailed answer..."
  Child 3.1: "Deliver a detailed, well-reasoned answer with concrete examples..."
  Child 3.2: "Offer a comprehensive response covering all aspects..."

éšç§æ¶ˆè€—ï¼š0 (ä¸ä½¿ç”¨ç§æœ‰æ•°æ®)
ç´¯è®¡é¢„ç®—ï¼šÎµ=0.6, Î´=1e-5 (ä¸å˜)

ã€æ–°ç§ç¾¤ã€‘3çˆ¶ä»£ + 6åä»£ = 9ä¸ª
é€‰æ‹©top-6è¿›å…¥ä¸‹ä¸€è½®
```

**è¿­ä»£2-5ï¼š**
```
é‡å¤ä¸Šè¿°æµç¨‹...

è¿­ä»£2ï¼šÎµç´¯è®¡=1.2, Î´=2e-5
è¿­ä»£3ï¼šÎµç´¯è®¡=1.8, Î´=3e-5
è¿­ä»£4ï¼šÎµç´¯è®¡=2.4, Î´=4e-5
è¿­ä»£5ï¼šÎµç´¯è®¡=3.0, Î´=5e-5 â†’ é¢„ç®—è€—å°½ï¼Œåœæ­¢
```

**æœ€ç»ˆç»“æœï¼š**
```python
optimized_prompt = "Provide a comprehensive, step-by-step answer with clear reasoning, concrete examples, and supporting evidence."

final_score = 0.68  # æå‡äº† +127%
privacy_consumed = (Îµ=3.0, Î´=5e-5)
```

### 4.2 éšç§æ³„éœ²é£é™©å¯¹æ¯”

**åœºæ™¯ï¼šè®­ç»ƒé›†åŒ…å«æ•æ„Ÿè®°å½•**

```
æ•æ„Ÿè®°å½•ï¼š"Patient X has rare disease Y"
```

#### **æ— DPä¿æŠ¤çš„æƒ…å†µï¼š**

```
æ•°æ®é›†Dï¼ˆå«è®°å½•Xï¼‰â†’ ä¼˜åŒ– â†’ æœ€ä¼˜prompt
  "When diagnosing rare disease Y, check for X's symptoms..."
  â†‘
  æ˜ç¡®æ³„éœ²äº†æ‚£è€…Xçš„ä¿¡æ¯ï¼âŒ

æ•°æ®é›†D'ï¼ˆä¸å«è®°å½•Xï¼‰â†’ ä¼˜åŒ– â†’ æœ€ä¼˜prompt
  "When diagnosing conditions, follow standard protocols..."
  â†‘
  å®Œå…¨ä¸åŒçš„ç»“æœ

æ”»å‡»è€…å¯ä»¥æ¨æ–­ï¼šè®°å½•Xå­˜åœ¨äºè®­ç»ƒé›†ä¸­ï¼
```

#### **æœ‰DPä¿æŠ¤çš„æƒ…å†µï¼š**

```
æ•°æ®é›†Dï¼ˆå«è®°å½•Xï¼‰â†’ DP-ESä¼˜åŒ– â†’ æœ€ä¼˜prompt
  "Provide comprehensive diagnosis considering all symptoms..."
  â†‘
  å™ªå£°æ©ç›–äº†è®°å½•Xçš„å½±å“

æ•°æ®é›†D'ï¼ˆä¸å«è®°å½•Xï¼‰â†’ DP-ESä¼˜åŒ– â†’ æœ€ä¼˜prompt
  "Provide detailed diagnosis with evidence-based reasoning..."
  â†‘
  ç»“æœç›¸ä¼¼ï¼

å·®åˆ†éšç§ä¿è¯ï¼š
Pr[prompt1] â‰¤ e^3.0 Ã— Pr[prompt2] + 5e-5
           â‰ˆ 20.09 Ã— Pr[prompt2] + 0.00005

æ”»å‡»è€…æ— æ³•æœ‰æ•ˆæ¨æ–­è®°å½•Xæ˜¯å¦å­˜åœ¨
```

---

## æ€»ç»“

### å˜å¼‚ç®—æ³•æ ¸å¿ƒ
1. **æ™ºèƒ½å˜å¼‚** - LLMç†è§£è¯­ä¹‰ç”Ÿæˆæ”¹è¿›
2. **è‡ªé€‚åº”ç­–ç•¥** - æ ¹æ®è¿›åº¦è‡ªåŠ¨è°ƒæ•´æ¢ç´¢/åˆ©ç”¨
3. **å¤šæ ·æ€§ä¿è¯** - é˜²æ­¢æ—©ç†Ÿæ”¶æ•›

### å·®åˆ†éšç§æ ¸å¿ƒ
1. **è¯„åˆ†åŠ å™ª** - é«˜æ–¯æœºåˆ¶æ©ç›–å•æ¡è®°å½•å½±å“
2. **é€‰æ‹©åŠ å™ª** - æŒ‡æ•°æœºåˆ¶/Gumbelå™ªå£°
3. **é¢„ç®—è¿½è¸ª** - é«˜çº§ç»„åˆå®šç†èŠ‚çœé¢„ç®—

### ç»“åˆä¼˜åŠ¿
- å˜å¼‚ä¸æ¶ˆè€—éšç§é¢„ç®—ï¼ˆæ€§èƒ½æå‡å…è´¹ï¼ï¼‰
- è¯„åˆ†å’Œé€‰æ‹©æ»¡è¶³DPï¼ˆéšç§æœ‰ä¿è¯ï¼‰
- æ€»ä½“è¾¾åˆ°(Îµ, Î´)-å·®åˆ†éšç§

---

**ğŸ¯ ä¸€å¥è¯æ€»ç»“ï¼š**
DP-ES = æ™ºèƒ½è¿›åŒ–ç®—æ³•ï¼ˆæ€§èƒ½ï¼‰+ å·®åˆ†éšç§ä¿æŠ¤ï¼ˆéšç§ï¼‰ = ä¸¤å…¨å…¶ç¾ï¼
